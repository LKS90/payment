<?php

class PaymentMenuRouterItemPermissionWebTestCase extends PaymentWebTestCase {

  static function getInfo() {
    return array(
      'name' => 'Payment menu router item permissions',
      'group' => 'Payment',
      'dependencies' => array('payment', 'paymentmethodbasic', 'xtools'),
    );
  }

  function setUp() {
    parent::setUp(array('payment', 'paymentmethodbasic', 'xtools'));
  }

  function testPaymentMenuRouterItemPermissions() {
    $payment = $this->paymentCreate(2, $this->paymentMethodCreate(2, payment_method_controller_load('PaymentMethodBasicController')));

    // Test the payment view page.
    $this->XtoolsAssertMenuRouterItemPermission('payment/' . $payment->pid, array('payment.view.any'));

    // Test the payment edit page.
    $this->XtoolsAssertMenuRouterItemPermission('payment/' . $payment->pid . '/edit', array('payment.update.any'));

    // Test the payment delete page.
    $this->XtoolsAssertMenuRouterItemPermission('payment/' . $payment->pid . '/delete', array('payment.delete.any'));

    // Test the administrative payment overview page (Views disabled).
    $this->XtoolsAssertMenuRouterItemPermission('admin/content/payment', array('payment.view.any'), array(), 'Views disabled');

    // Test a user's payment overview page (Views disabled).
    $this->XtoolsAssertMenuRouterItemPermission('user/2/payment', array('payment.view.own'), array(), 'Views disabled');

    // Enable Views.
    $this->assertTrue(module_enable(array('views')), 'Enabled modules: <em>views</em>');
    $this->resetAll();

    // Test the administrative payment overview page (Views enabled).
    $this->XtoolsAssertMenuRouterItemPermission('admin/content/payment', array('payment.view.any'), array(), 'Views enabled');

    // Test a user's payment overview page (Views enabled).
    $this->XtoolsAssertMenuRouterItemPermission('user/2/payment', array('payment.view.own'), array(), 'Views enabled');
  }
}