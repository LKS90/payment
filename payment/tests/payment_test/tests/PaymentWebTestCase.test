<?php

class PaymentWebTestCase extends XtoolsWebTestCase {

  /**
   * Create, save, and return a Payment.
   *
   * @param integer $uid
   *   The user ID of the payment's owner.
   * @param PaymentMethod $payment_method
   *   An optional payment method to set. Defaults to PaymentMethodUnavailable.
   *
   * @return Payment
   */
  function paymentCreate($uid, PaymentMethod $payment_method = NULL) {
    $payment_method = $payment_method ? $payment_method : new PaymentMethodUnavailable;
    $payment = new Payment(array(
      'currency_code' => 'XXX',
      'finish_callback' => 'payment_test_finish_callback',
      'method' => $payment_method,
      'uid' => $uid,
    ));
    $payment->setLineItem(new PaymentLineItem(array(
      'name' => 'foo',
      'amount' => 1.0,
      'tax_rate' => 0.1,
    )));
    entity_save('payment', $payment);

    return $payment;
  }

  /**
   * Create, save, and return a PaymentMethod.
   *
   * @param integer $uid
   *   The user ID of the payment method's owner.
   * @param PaymentMethodController $controller
   *   An optional controller to set. Defaults to
   *   PaymentMethodControllerUnavailable.
   *
   * @return PaymentMethod
   */
  function paymentMethodCreate($uid, PaymentMethodController $controller = NULL) {
    $name = $this->randomName();
    $controller = $controller ? $controller : payment_method_controller_load('PaymentMethodControllerUnavailable');
    $payment_method = new PaymentMethod(array(
      'controller' => $controller,
      'controller_data' => $controller->controller_data_defaults,
      'name' => $name,
      'title' => $name,
      'uid' => $uid,
    ));
    entity_save('payment_method', $payment_method);

    return $payment_method;
  }
}